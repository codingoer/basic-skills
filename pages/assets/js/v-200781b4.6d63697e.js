"use strict";(self.webpackChunknotebook=self.webpackChunknotebook||[]).push([[8506],{26275:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e={key:"v-200781b4",path:"/server/vmware/company-intranet-dns.html",title:"模拟公司内网开发环境",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"搭建DNS服务器",slug:"搭建dns服务器",children:[{level:3,title:"安装bind软件",slug:"安装bind软件",children:[]},{level:3,title:"Bind的默认路径设定与chroot",slug:"bind的默认路径设定与chroot",children:[]},{level:3,title:"编辑/etc/named.conf文件",slug:"编辑-etc-named-conf文件",children:[]},{level:3,title:"数据库档案设定",slug:"数据库档案设定",children:[]},{level:3,title:"DNS 的启动观察与防火墙",slug:"dns-的启动观察与防火墙",children:[]}]}],filePathRelative:"server/vmware/company-intranet-dns.md",git:{updatedTime:1639064924e3,contributors:[{name:"codingoer",email:"codingoer@163.com",commits:1}]}}},99827:(n,s,a)=>{a.r(s),a.d(s,{default:()=>p});const e=(0,a(66252).uE)('<h1 id="模拟公司内网开发环境" tabindex="-1"><a class="header-anchor" href="#模拟公司内网开发环境" aria-hidden="true">#</a> 模拟公司内网开发环境</h1><h2 id="搭建dns服务器" tabindex="-1"><a class="header-anchor" href="#搭建dns服务器" aria-hidden="true">#</a> 搭建DNS服务器</h2><p>使用<strong>172.16.203.130</strong>这台机器</p><h3 id="安装bind软件" tabindex="-1"><a class="header-anchor" href="#安装bind软件" aria-hidden="true">#</a> 安装bind软件</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum -y <span class="token function">install</span> bind*\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><img src="https://image.hualihai.cn/blog/7W8aeb.png" alt="7W8aeb"></p><p>启动<strong>bind</strong>服务</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>systemctl start named.service\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>查看端口判断服务是否启动成功</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">netstat</span> -an <span class="token operator">|</span> <span class="token function">grep</span> :53\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><img src="https://image.hualihai.cn/blog/68VpCa.png" alt="68VpCa"></p><h3 id="bind的默认路径设定与chroot" tabindex="-1"><a class="header-anchor" href="#bind的默认路径设定与chroot" aria-hidden="true">#</a> Bind的默认路径设定与<strong>chroot</strong></h3><p>chroot代表的是 <strong>change to root(根目录)</strong> 的意思，root代表的是根目录。CentOS默认将bind锁在<code>/var/named/chroot</code>目录中.</p><p>由于CentOS已经透过启动脚本帮我们进行档案与目录的挂载链接，所以请你直接修改<code>/etc/named.conf</code>即可，不要再去<code>/var/named/chroot/etc/named.conf</code>修改.</p><p>BIND的配置文件为<code>/etc/named.conf</code></p><p><img src="https://image.hualihai.cn/blog/za2Gmd.png" alt="za2Gmd"></p><h3 id="编辑-etc-named-conf文件" tabindex="-1"><a class="header-anchor" href="#编辑-etc-named-conf文件" aria-hidden="true">#</a> 编辑<code>/etc/named.conf</code>文件</h3><p>原始文件内容</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>//\n// named.conf\n//\n// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS\n// server as a caching only nameserver (as a localhost DNS resolver only).\n//\n// See /usr/share/doc/bind<span class="token important">*/sample/</span> for example named configuration files.\n//\n// See the BIND Administrator&#39;s Reference Manual (ARM) for details about the\n// configuration located in /usr/share/doc/bind<span class="token punctuation">-</span><span class="token punctuation">{</span>version<span class="token punctuation">}</span>/Bv9ARM.html\n\noptions <span class="token punctuation">{</span>\n        listen<span class="token punctuation">-</span>on port 53 <span class="token punctuation">{</span> 127.0.0.1; <span class="token punctuation">}</span>;\n        listen<span class="token punctuation">-</span>on<span class="token punctuation">-</span>v6 port 53 <span class="token punctuation">{</span> <span class="token punctuation">:</span><span class="token punctuation">:</span>1; <span class="token punctuation">}</span>;\n        directory       &quot;/var/named&quot;;\n        dump<span class="token punctuation">-</span>file       &quot;/var/named/data/cache_dump.db&quot;;\n        statistics<span class="token punctuation">-</span>file &quot;/var/named/data/named_stats.txt&quot;;\n        memstatistics<span class="token punctuation">-</span>file &quot;/var/named/data/named_mem_stats.txt&quot;;\n        recursing<span class="token punctuation">-</span>file  &quot;/var/named/data/named.recursing&quot;;\n        secroots<span class="token punctuation">-</span>file   &quot;/var/named/data/named.secroots&quot;;\n        allow<span class="token punctuation">-</span>query     <span class="token punctuation">{</span> localhost; <span class="token punctuation">}</span>;\n\n        /* \n         <span class="token punctuation">-</span> If you are building an AUTHORITATIVE DNS server<span class="token punctuation">,</span> do NOT enable recursion.\n         <span class="token punctuation">-</span> If you are building a RECURSIVE (caching) DNS server<span class="token punctuation">,</span> you need to enable \n           recursion. \n         <span class="token punctuation">-</span> If your recursive DNS server has a public IP address<span class="token punctuation">,</span> you MUST enable access \n           control to limit queries to your legitimate users. Failing to do so will\n           cause your server to become part of large scale DNS amplification \n           attacks. Implementing BCP38 within your network would greatly\n           reduce such attack surface \n        <span class="token important">*/</span>\n        recursion yes;\n\n        dnssec<span class="token punctuation">-</span>enable yes;\n        dnssec<span class="token punctuation">-</span>validation yes;\n\n        /* Path to ISC DLV key <span class="token important">*/</span>\n        bindkeys<span class="token punctuation">-</span>file &quot;/etc/named.root.key&quot;;\n\n        managed<span class="token punctuation">-</span>keys<span class="token punctuation">-</span>directory &quot;/var/named/dynamic&quot;;\n\n        pid<span class="token punctuation">-</span>file &quot;/run/named/named.pid&quot;;\n        session<span class="token punctuation">-</span>keyfile &quot;/run/named/session.key&quot;;\n<span class="token punctuation">}</span>;\n\nlogging <span class="token punctuation">{</span>\n        channel default_debug <span class="token punctuation">{</span>\n                file &quot;data/named.run&quot;;\n                severity dynamic;\n        <span class="token punctuation">}</span>;\n<span class="token punctuation">}</span>;\n\nzone &quot;.&quot; IN <span class="token punctuation">{</span>\n        type hint;\n        file &quot;named.ca&quot;;\n<span class="token punctuation">}</span>;\n\ninclude &quot;/etc/named.rfc1912.zones&quot;;\ninclude &quot;/etc/named.root.key&quot;;\n\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><p>修改内容</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>listen<span class="token punctuation">-</span>on port 53 <span class="token punctuation">{</span> any; <span class="token punctuation">}</span>;\nallow<span class="token punctuation">-</span>query     <span class="token punctuation">{</span> any; <span class="token punctuation">}</span>;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="数据库档案设定" tabindex="-1"><a class="header-anchor" href="#数据库档案设定" aria-hidden="true">#</a> 数据库档案设定</h3><ul><li>编辑<code>named.rfc1912.zones</code>文件</li></ul><p>添加内容</p><div class="language-conf ext-conf line-numbers-mode"><pre class="language-conf"><code>zone &quot;stage.com&quot; IN {\n       type master;\n       file &quot;named.stage.com&quot;;\n       allow-update { none; };\n};\n\nzone &quot;203.16.172.in-addr.arpa&quot; IN {\n       type master;\n       file &quot;named.172.16.203&quot;;\n       allow-update { none; };\n};\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>创建 <strong>named.stage.com</strong> 文件</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">touch</span> /var/named/named.stage.com\n<span class="token function">vim</span> /var/named/named.centos.vbird\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>添加如下内容</p><div class="language-conf ext-conf line-numbers-mode"><pre class="language-conf"><code>$TTL  1H\n@       IN SOA dns.stage.com. lionel.mail.stage.com.(2020112301 3H 15M 1W 1D)\n@       IN NS   dns.stage.com.\n\n\ndns.stage.com.    IN A      172.16.203.130\nwww.stage.com.    IN A    172.16.203.140\ngoods.stage.com.   IN A    172.16.203.140\ncart.stage.com.   IN A   172.16.203.140\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>创建 <strong>named.172.16.203</strong> 文件</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /var/named/named.172.16.203\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>添加如下内容</p><div class="language-conf ext-conf line-numbers-mode"><pre class="language-conf"><code>$TTL  600\n@       IN SOA  dns.stage.com. lionel.mail.stage.com.(2020112301 3H 15M 1W 1D)\n@       IN NS   dns.stage.com.\n\n130    IN PTR    dns.stage.com.\n140    IN PTR    www.stage.com.\n140    IN PTR    goods.stage.com.\n140    IN PTR    cart.stage.com.\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="dns-的启动观察与防火墙" tabindex="-1"><a class="header-anchor" href="#dns-的启动观察与防火墙" aria-hidden="true">#</a> DNS 的启动观察与防火墙</h3><ul><li>启动DNS</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>systemctl start named.service\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>查看日志</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">tail</span> -n <span class="token number">30</span> /var/log/messages <span class="token operator">|</span> <span class="token function">grep</span> named\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>开放53端口</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">53</span>/tcp --permanent\nfirewall-cmd --reload\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div>',40),l={},p=(0,a(83744).Z)(l,[["render",function(n,s){return e}]])},83744:(n,s)=>{s.Z=(n,s)=>{const a=n.__vccOpts||n;for(const[n,e]of s)a[n]=e;return a}}}]);